<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ScanHandler.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HBase driver for n-orm</a> &gt; <a href="index.html" class="el_package">org.apache.hadoop.hbase.mapreduce</a> &gt; <span class="el_source">ScanHandler.java</span></div><h1>ScanHandler.java</h1><pre class="source lang-java linenums">package org.apache.hadoop.hbase.mapreduce;

import static org.apache.hadoop.hbase.mapreduce.TableInputFormat.*;

import java.io.IOException;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.hbase.KeyValue;
import org.apache.hadoop.hbase.client.Scan;
import org.apache.hadoop.hbase.util.Bytes;
import org.apache.hadoop.util.StringUtils;

<span class="nc" id="L15">public class ScanHandler {</span>
<span class="fc" id="L16">	private static final Log LOG = LogFactory.getLog(TableInputFormat.class);</span>
	//Copied from org.apache.hadoop.hbase.mapreduce.TableInputFormat.setConf(Configuration)
	@SuppressWarnings(&quot;deprecation&quot;)
	public static Scan getScan(Configuration conf) {
<span class="fc" id="L20">		Scan scan = new Scan();</span>
<span class="pc bpc" id="L21" title="1 of 2 branches missed.">		if (conf.get(SCAN) != null) {</span>
			try {
<span class="fc" id="L23">				scan = TableMapReduceUtil.convertStringToScan(conf.get(SCAN));</span>
<span class="nc" id="L24">			} catch (IOException e) {</span>
<span class="nc" id="L25">				LOG.error(&quot;An error occurred.&quot;, e);</span>
<span class="pc" id="L26">			}</span>
		} else {
			try {
<span class="nc" id="L29">				scan = new Scan();</span>

<span class="nc bnc" id="L31" title="All 2 branches missed.">				if (conf.get(SCAN_COLUMNS) != null) {</span>
<span class="nc" id="L32">					addColumns(scan, conf.get(SCAN_COLUMNS));</span>
				}

<span class="nc bnc" id="L35" title="All 2 branches missed.">				if (conf.get(SCAN_COLUMN_FAMILY) != null) {</span>
<span class="nc" id="L36">					scan.addFamily(Bytes.toBytes(conf.get(SCAN_COLUMN_FAMILY)));</span>
				}

<span class="nc bnc" id="L39" title="All 2 branches missed.">				if (conf.get(SCAN_TIMESTAMP) != null) {</span>
<span class="nc" id="L40">					scan.setTimeStamp(Long.parseLong(conf.get(SCAN_TIMESTAMP)));</span>
				}

<span class="nc bnc" id="L43" title="All 4 branches missed.">				if (conf.get(SCAN_TIMERANGE_START) != null</span>
						&amp;&amp; conf.get(SCAN_TIMERANGE_END) != null) {
<span class="nc" id="L45">					scan.setTimeRange(</span>
							Long.parseLong(conf.get(SCAN_TIMERANGE_START)),
							Long.parseLong(conf.get(SCAN_TIMERANGE_END)));
				}

<span class="nc bnc" id="L50" title="All 2 branches missed.">				if (conf.get(SCAN_MAXVERSIONS) != null) {</span>
<span class="nc" id="L51">					scan.setMaxVersions(Integer.parseInt(conf</span>
							.get(SCAN_MAXVERSIONS)));
				}

<span class="nc bnc" id="L55" title="All 2 branches missed.">				if (conf.get(SCAN_CACHEDROWS) != null) {</span>
<span class="nc" id="L56">					scan.setCaching(Integer.parseInt(conf.get(SCAN_CACHEDROWS)));</span>
				}

				// false by default, full table scans generate too much BC churn
<span class="nc" id="L60">				scan.setCacheBlocks((conf.getBoolean(SCAN_CACHEBLOCKS, false)));</span>
<span class="nc" id="L61">			} catch (Exception e) {</span>
<span class="nc" id="L62">				LOG.error(StringUtils.stringifyException(e));</span>
<span class="nc" id="L63">			}</span>
		}
<span class="fc" id="L65">		return scan;</span>
	}

	private static void addColumns(Scan scan, String columns) {
<span class="nc" id="L69">		String[] cols = columns.split(&quot; &quot;);</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">		for (String col : cols) {</span>
<span class="nc" id="L71">			addColumn(scan, Bytes.toBytes(col));</span>
		}
<span class="nc" id="L73">	}</span>
	
	private static void addColumn(Scan scan, byte[] familyAndQualifier) {
<span class="nc" id="L76">	    byte [][] fq = KeyValue.parseColumn(familyAndQualifier);</span>
<span class="nc bnc" id="L77" title="All 6 branches missed.">	    if (fq.length &gt; 1 &amp;&amp; fq[1] != null &amp;&amp; fq[1].length &gt; 0) {</span>
<span class="nc" id="L78">	      scan.addColumn(fq[0], fq[1]);</span>
	    } else {
<span class="nc" id="L80">	      scan.addFamily(fq[0]);</span>
	    }
<span class="nc" id="L82">	  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.0.201210061924</span></div></body></html>