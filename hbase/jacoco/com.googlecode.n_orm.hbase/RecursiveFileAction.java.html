<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>RecursiveFileAction.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HBase driver for n-orm</a> &gt; <a href="index.html" class="el_package">com.googlecode.n_orm.hbase</a> &gt; <span class="el_source">RecursiveFileAction.java</span></div><h1>RecursiveFileAction.java</h1><pre class="source lang-java linenums">package com.googlecode.n_orm.hbase;

import java.io.File;
import java.util.Collection;
import java.util.LinkedList;
import java.util.Set;
import java.util.TreeSet;

import org.codehaus.plexus.util.DirectoryScanner;

public abstract class RecursiveFileAction {

	private final Collection&lt;String&gt; toBeExploredFiles;
	private final Collection&lt;String&gt; toBeExplored;
	private final Collection&lt;String&gt; toBeIgnoredFilters;
	private final Collection&lt;String&gt; toBeExploredFilters;
	
<span class="fc" id="L18">	public static abstract class Report {</span>
		public abstract void fileHandled(File f);
	}
	
<span class="fc" id="L22">	public RecursiveFileAction() {</span>
<span class="fc" id="L23">		toBeIgnoredFilters = new LinkedList&lt;String&gt;();</span>
<span class="fc" id="L24">		toBeExploredFilters = new LinkedList&lt;String&gt;();</span>
<span class="fc" id="L25">		toBeExplored = new LinkedList&lt;String&gt;();</span>
<span class="fc" id="L26">		toBeExploredFiles = new LinkedList&lt;String&gt;();</span>
<span class="fc" id="L27">	}</span>
	
	public void addIgnoredFile(String toBeIgnored) {
<span class="fc" id="L30">		this.toBeIgnoredFilters.add(toBeIgnored);</span>
<span class="fc" id="L31">	}</span>
	
	public void clearIgnoredFiles() {
<span class="nc" id="L34">		this.toBeIgnoredFilters.clear();</span>
<span class="nc" id="L35">	}</span>
	
	public void addExploredFile(String toBeExplored) {
<span class="fc" id="L38">		File tbe = new File(toBeExplored);</span>
<span class="pc bpc" id="L39" title="1 of 4 branches missed.">		if (toBeExplored.contains(&quot;*&quot;) || toBeExplored.contains(&quot;?&quot;))</span>
<span class="fc" id="L40">			this.toBeExploredFilters.add(toBeExplored);</span>
<span class="fc bfc" id="L41" title="All 2 branches covered.">		else if (tbe.isFile())</span>
<span class="fc" id="L42">			this.toBeExploredFiles.add(toBeExplored);</span>
<span class="fc bfc" id="L43" title="All 2 branches covered.">		else if (tbe.isDirectory())</span>
<span class="fc" id="L44">			this.toBeExplored.add(toBeExplored);</span>
		else
<span class="fc" id="L46">			HBase.logger.warning(toBeExplored + &quot; is neither a filter (no *, **, or ? found) nor a valid directory ; ignoring&quot;);</span>
<span class="fc" id="L47">	}</span>
	
	public void clear() {
<span class="fc" id="L50">		this.toBeIgnoredFilters.clear();</span>
<span class="fc" id="L51">		this.toBeExploredFilters.clear();</span>
<span class="fc" id="L52">		this.toBeExplored.clear();</span>
<span class="fc" id="L53">		this.toBeExploredFiles.clear();</span>
<span class="fc" id="L54">	}</span>
	
	public void addFiles(String... files) {
<span class="fc bfc" id="L57" title="All 2 branches covered.">		for (String file : files) {</span>
<span class="fc" id="L58">			file = file.trim();</span>
<span class="pc bpc" id="L59" title="1 of 2 branches missed.">			if (file.length() &gt; 0) {</span>
<span class="fc bfc" id="L60" title="All 2 branches covered.">				if (file.startsWith(&quot;!&quot;))</span>
<span class="fc" id="L61">					this.addIgnoredFile(file.substring(1));</span>
				else
<span class="fc" id="L63">					this.addExploredFile(file);</span>
			}
		}
<span class="fc" id="L66">	}</span>
		
	public void addFiles(String comaSeparatedFiles) {
<span class="fc" id="L69">		this.addFiles(comaSeparatedFiles.split(&quot;,&quot;));</span>
<span class="fc" id="L70">	}</span>
	
	public void explore(Report r) {
<span class="pc bpc" id="L73" title="1 of 2 branches missed.">		if (this.toBeExplored.isEmpty())</span>
<span class="nc" id="L74">			throw new IllegalArgumentException(&quot;No directory found ; please provide at least one directory with a non filter expression (with no *, **, or ?).&quot;);</span>
<span class="fc" id="L75">		DirectoryScanner scanner = new DirectoryScanner();</span>
<span class="fc bfc" id="L76" title="All 2 branches covered.">		if (!this.toBeExploredFilters.isEmpty())</span>
<span class="fc" id="L77">			scanner.setIncludes(this.toBeExploredFilters.toArray(new String[0]));</span>
<span class="fc bfc" id="L78" title="All 2 branches covered.">		if (!this.toBeIgnoredFilters.isEmpty())</span>
<span class="fc" id="L79">			scanner.setExcludes(this.toBeIgnoredFilters.toArray(new String[0]));</span>
<span class="fc" id="L80">		scanner.addDefaultExcludes();</span>
<span class="fc" id="L81">		scanner.setCaseSensitive(false);</span>
		
<span class="fc" id="L83">		Set&lt;String&gt; found = new TreeSet&lt;String&gt;();</span>
<span class="fc" id="L84">		found.addAll(toBeExploredFiles);</span>
		
<span class="fc bfc" id="L86" title="All 2 branches covered.">		for (String tbe : this.toBeExplored) {</span>
<span class="fc" id="L87">			scanner.setBasedir(tbe);</span>
<span class="fc" id="L88">			scanner.scan();</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">			for (String ff : scanner.getIncludedFiles()) {</span>
<span class="fc" id="L90">				found.add(tbe+File.separatorChar+ff);</span>
			}
<span class="fc" id="L92">		}</span>
		
<span class="fc bfc" id="L94" title="All 2 branches covered."> 		for (String file : found) {</span>
<span class="fc" id="L95">			File f = new File(file);</span>
<span class="fc bfc" id="L96" title="All 2 branches covered.">			if (this.acceptFile(f)) {</span>
<span class="fc" id="L97">				this.fileFound(f, r);</span>
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">				if (r != null)</span>
<span class="fc" id="L99">					r.fileHandled(f);</span>
			}
<span class="fc" id="L101">		}</span>
<span class="fc" id="L102">	}</span>
	
	public boolean acceptFile(File file) {
<span class="nc" id="L105">		return true;</span>
	}
	
	public abstract void fileFound(File f, Report r);

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.0.201210061924</span></div></body></html>